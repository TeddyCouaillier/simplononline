{% extends 'base.html.twig' %}

{% import 'macro.html.twig' as template %}

{% block title %}{{ project.title }}{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
<link rel="stylesheet" href="/css/project.css">
{% endblock %}

{% form_theme form _self 'jquery.collection.html.twig' %}

{% block body %}
    {{ template.checkMessage(form) }}
    {{ template.checkMessage(formCorrect) }}
    <div class="px-5">
        <div class="flex just-between">
            <h1>{{ project.title }}</h1>
            {% if is_granted('ROLE_ADMIN') or project.moderator == app.user %}
            <a href="{{ path('project_edit',{'slug': project.slug}) }}" class="button-edit"><i class="fal fa-pen bold"></i></a>
            {% endif %}
        </div>
        <span class="text-grey">{{ project.description|default('<em>Pas de description</em>')|raw }}</span>
        <div class="flex mt-2 mb-3">
            {% for user in project.users %}
                <img src="/img/avatar/{{user.avatar}}" class="avatar-xs" data-toggle="tooltip" data-placement="top" title="{{user.fullname}}">
            {% endfor %}
        </div>
        <div class="progress">
            <div class="progress-bar status-{{project.progresscolor(progress)}}" role="progressbar" style="width: {{progress}}%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div class="flex just-between">
            <div>
                {% if project.github != null %}
                <a href="{{ project.github  }}" target="_blank" class="text-grey text-small"><i class="far fa-code-branch"></i> GitHub</a> &nbsp;
                {% endif %}
                {% if project.website != null %}
                <a href="{{ project.website }}" target="_blank" class="text-grey text-small"><i class="far fa-eye"></i> Voir le site</a>
                {% endif %}
            </div>
            <div class="text-grey text-small">
                <span>{{ project.interval }}</span>
            </div>
        </div>
        <div class="container-grey flex my-4">
            <div class="text-center project-nav active" data-project="task" onclick="projectPanel(this)">Tâches</div>
            <div class="text-center project-nav" data-project="detail" onclick="projectPanel(this)">Informations détaillées</div>
            <div class="text-center project-nav" data-project="activity" onclick="projectPanel(this)">Corrigés</div>
        </div>
        <hr>
        {{ include('project/_task.html.twig') }}
        {{ include('project/_detail.html.twig') }}
        {{ include('project/_activity.html.twig') }}
    </div> 


{% endblock %}

{% block _task_subtasks_entry_row %}
{{ form_widget(form) }}
{% endblock %}

{% block _task_subtasks_entry_widget %}
<div class="flex just-around align-center rounded task-add-subtask">
        <div>{{ form_widget(form.title) }}</div>
        <div>{{ form_widget(form.done) }}</div>
</div>
{% endblock %}

{% block javascripts %}
    <script type="text/javascript">
        $('.task').collection({
            'up': '<a href="#" class="mx-1"><i class="fal fa-chevron-circle-up"></i></a>',
            'down': '<a href="#" class="mx-1"><i class="fal fa-chevron-circle-down"></i></a>',
            'remove': '<a href="#" class="mx-1 text-red"><i class="fal fa-times-circle"></i></a>',
            'add': '<button class="button-edit my-2 mx-auto d-block"><i class="fal fa-plus"></i></button>',
            'add_at_the_end': true
        });
    </script>
{% endblock %}

{% block libraries %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
{% endblock %}

