{% extends 'base_admin.html.twig' %}

{% import 'macro.html.twig' as template %}

{% block title %}Liste des promotions{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
{% endblock %}

{% block body %}
{{ template.checkMessage(form,"Verifiez les dates")}}
<div class="px-1 my-4">
    <div class="flex just-between align-center">
        <h1 class="w-75">Liste des promotions</h1>
        {{ template.add() }}
    </div>
    <hr>
    <table class="table table-hover text-center bg-white shadow-small admin-promotion">
        <thead>
            <tr>
                <th scope="col"></th>
                <th scope="col">Label</th>
                <th scope="col">Slug</th>
                <th scope="col">Surnom</th>
                <th scope="col">Formateurs</th>
                <th scope="col">Médiateurs</th>
                <th scope="col">Apprenants</th>
                <th scope="col">Actuelle</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for promotion in promotions %}
                {{ template.deleteConfirm(promotion.id,path('promo_delete',{'id':promotion.id})) }}
                {{ template.modalPromotion('modal-promo-edit-'~promotion.id) }}
                <tr>
                    <td>
                        {% set startAt = promotion.startAt|date('d/m/Y') %}
                        {% set endAt   = promotion.endAt|date('d/m/Y') %}
                        {% if promotion.startAt is null %}
                        {% set startAt = '--/--/----' %}
                        {% endif %}
                        {% if promotion.endAt is null %}
                        {% set endAt = '--/--/----' %}
                        {% endif %}
                        <i class="fal fa-info-circle rhover" data-html="true" data-toggle="tooltip" data-placement="top" data-original-title=
                        "Débutée le {{ startAt }} <br>
                         Terminée le {{ endAt }}">
                        </i>
                    </td>
                    <td>{{ promotion.label }}</td>
                    <td>{{ promotion.slug }}</td>
                    <td>{{ promotion.nickname }}</td>
                    <td>
                        {% for former in promotion.formers %}
                            {{ former.fullname }}<br>
                        {% else %}
                            Aucun
                        {% endfor %}
                    </td>
                    <td>
                        {% for mediator in promotion.mediators %}
                            {{ mediator.fullname }}<br>
                        {% else %}
                            Aucun
                        {% endfor %}
                    </td>
                    <td>
                        {% if promotion.users is not empty %}
                            {{ promotion.users|length }}
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td class="flex just-center">
                        <input class="switch_base promocurrent" data-promourl="{{path('admin_promo_active',{'id':promotion.id}) }}"
                        type="checkbox" {% if promotion.current %} checked {% endif %}>
                    </td>
                    <td>
                        <div class="btn-group" role="group">
                            <div class="btn-group" role="group">
                                <button class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Modifier
                                </button>
                                <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                    <a class="dropdown-item rhover" href="{{ path('promo_edit_users',{'slug': promotion.slug}) }}">Ajouter</a>
                                    <a data-url="{{ path('admin_promo_edit',{'id':promotion.id}) }}" data-toggle="modal" data-target="#modal-promo-edit-{{promotion.id}}" class="dropdown-item rhover promo-edit"><span class="rhover">Modifier</span></a>
                                    <a class="dropdown-item rhover" href="{{ path('promo_show',{'slug': promotion.slug }) }}">Afficher</a>
                                </div>
                            </div>

                            <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#modal-{{promotion.id}}"><i class="fal fa-times-circle"></i></button>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="w-100 admin-promotion-responsive">
    {% for promotion in promotions %}
        <div class="container-white row flex align-center mx-0 my-1 shadow-small">
            <div class="col-4 col-sm-6">{{ promotion.label }}</div>
            <div class="col-2 col-sm-2 flex just-center">
                <input class="switch_base promocurrent" data-promourl="{{path('admin_promo_active',{'id':promotion.id}) }}"
                type="checkbox" {% if promotion.current %} checked {% endif %}>
            </div>
            <div class="col-6 col-sm-4">
                <div class="btn-group" role="group">
                    <div class="btn-group" role="group">
                        <button class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Modifier
                        </button>
                        <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                            <a class="dropdown-item rhover" href="{{ path('promo_edit_users',{'slug': promotion.slug}) }}">Ajouter</a>
                            <a data-url="{{ path('admin_promo_edit',{'id':promotion.id}) }}" data-toggle="modal" data-target="#modal-promo-edit-{{promotion.id}}" class="dropdown-item rhover promo-edit"><span class="rhover">Modifier</span></a>
                            <a class="dropdown-item rhover" href="{{ path('promo_show',{'slug': promotion.slug }) }}">Afficher</a>
                        </div>
                    </div>

                    <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#modal-{{promotion.id}}"><i class="fal fa-times-circle"></i></button>
                </div>
            </div>
        </div>
    {% endfor %}
</div>
{% endblock %}

{% block modalTitle %}Ajouter une promotion{% endblock %}
{% block modalBody %}
<div class="container-white">
    {{ form_start(form) }}
        <div class="mb-3">
        {{ form_label(form.label) }}
        {{ form_widget(form.label) }}
        </div>
        <div class="mt-3">
        {{ form_label(form.nickname) }}
        {{ form_widget(form.nickname) }}
        </div>
        <div class="mt-3">
            <div class="w-100">
            {{ form_widget(form.moderators, {'attr': {
                'class': 'promo-mod-selected selectpicker',
                'title': 'Formateur(s) et médiateur(s) de la promo',
                'data-live-search': 'true',
                'multiple': '',
                'data-selected-text-format': 'count > 2',
                'data-style': 'bg-white',
                'data-size': '6'
            }}) }}
            </div>
            <div class="row my-1">
                <div class="col-5">{{ form_label(form.startAt) }}</div>
                <div class="col-7">{{ form_widget(form.startAt) }}</div>
            </div>
            <div class="row my-1">
                <div class="col-5">{{ form_label(form.endAt) }}</div>
                <div class="col-7">{{ form_widget(form.endAt) }}</div>
            </div>
        </div>
        {{ template.confirm() }}
    {{ form_end(form) }}
</div>
{% endblock %}

{% block libraries %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
{% endblock %}