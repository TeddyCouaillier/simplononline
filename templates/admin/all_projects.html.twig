{% extends 'base_admin.html.twig' %}

{% import 'macro.html.twig' as template %}

{% block title %}Liste des projets{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
<link rel="stylesheet" href="/css/project.css">
{% endblock %}

{% block body %}
<div class="container px-5 my-4">
    <div class="flex just-between align-center">
        <h1>Liste des projets</h1>
        <a href="{{ path('project_create') }}" class="button-edit"><i class="fal fa-plus"></i></a>
    </div>
    <hr>
    <table class="table table-hover text-center bg-white shadow-small">
        <thead>
            <tr>
                <th scope="col">Fini</th>
                <th scope="col">Titre</th>
                <th scope="col">Créé</th>
                <th scope="col">Liens</th>
                <th scope="col">Participant</th>
                <th scope="col">Modérateur</th>
                <th scope="col">Tâches</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for project in projects %}
            {{ template.deleteConfirm(project.id,path('project_delete',{'slug':project.slug})) }}
            {{ template.modal('add-project-correction-'~project.id)}}
            {{ template.modal('add-project-task-'~project.id)}}
            {{ template.modal('edit-project-'~project.id)}}
            <tr>
                <td class="flex just-center">
                    {% if project.completed %}
                    <div class="completed"
                    data-toggle="tooltip" data-placement="top" title="Terminé le {{ project.endAt | date('d/m/Y') }}">
                    </div>
                    {% endif %}
                <td>
                    <a href="{{ path('project_show',{'slug':project.slug}) }}" class="rhover">
                        {{ project.title|truncate(25) }}
                    </a>
                </td>
                <td>{{ project.interval }}</td>
                <td>
                    {% if project.github is not null %}
                    <a href="{{ project.github }}" target="_blank"><i class="fal fa-code-branch"></i></a>
                    {% else %}
                    -
                    {% endif %}
                    {% if project.website is not null %}
                    <a href="{{ project.website }}" target="_blank"><i class="fal fa-globe"></i></a>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>
                    {% if project.users is not empty %}
                    {% for user in project.users %}
                        {{ user.firstname }} &nbsp;
                    {% endfor %}
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>{{ project.moderator.firstname }}</td>
                <td>
                    {% if project.tasks is not empty %}
                    {{ project.tasks|length}}
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>
                    <div class="btn-group" role="group">
                        <div class="btn-group" role="group">
                            <button class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Modifier
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item rhover add-project-correction" data-url="{{path('admin_project_edit_correction',{'id': project.id}) }}" data-toggle="modal" data-target="#add-project-correction-{{project.id}}">Ajouter une correction</a>
                                <a class="dropdown-item rhover">Ajouter un utilisateur</a>
                                <a class="dropdown-item rhover">Retirer un utilisateur</a>
                                <a class="dropdown-item rhover add-project-task" data-url="{{path('admin_project_add_task',{'id': project.id}) }}" data-toggle="modal" data-target="#add-project-task-{{project.id}}">Ajouter une tache</a>
                                <a class="dropdown-item rhover edit-project" data-url="{{path('admin_project_edit',{'id': project.id}) }}" data-toggle="modal" data-target="#edit-project-{{project.id}}">Modifier</a>
                            </div>
                        </div>
                        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#modal-{{project.id}}"><i class="fal fa-times-circle"></i></button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block libraries %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
{% endblock %}